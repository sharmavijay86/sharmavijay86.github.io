<!DOCTYPE html> <html lang=" en "><head> <meta charset="utf-8" /> <title> Openshift4 all in one setup - Vijay K. </title> <meta http-equip="X-UA-Compatible" content="IE=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1" /> <meta name="description" content="Openshift4 all in one setup- Openshift4 all in one setup"> <meta name="keywords" content="Openshift4 all in one setup, Vijay K., k8s,"/> <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" /> <meta content="" property="fb:app_id" /> <meta content="Vijay K." property="og:site_name" /> <meta content="Openshift4 all in one setup" property="og:title" /> <meta content="article" property="og:type" /> <meta content="Openshift4 all in one setup" property="og:description" /> <meta content="http://0.0.0.0:4000/blog/openshift4-all-in-one-setup/" property="og:url" /> <meta content="2023-02-18T09:05:23-06:00" property="article:published_time" /> <meta content="http://0.0.0.0:4000/about/" property="article:author" /> <meta content="http://0.0.0.0:4000/assets/img/posts/kubernetes3.jpg" property="og:image" /> <meta content="k8s" property="article:section" /> <!-- Twitter Cards --> <meta name="twitter:card" content="summary" /> <meta name="twitter:site" content="@" /> <meta name="twitter:creator" content="@" /> <meta name="twitter:title" content="Openshift4 all in one setup" /> <meta name="twitter:url" content="http://0.0.0.0:4000/blog/openshift4-all-in-one-setup/" /> <meta name="twitter:description" content="Openshift4 all in one setup" /> <link rel="stylesheet" href="http://0.0.0.0:4000/assets/css/main.css" /> <!-- <link rel="stylesheet" href="http://0.0.0.0:4000/assets/css/custom-style.css" /> --> <link rel="stylesheet" href="http://0.0.0.0:4000/assets/bower_components/lightgallery/dist/css/lightgallery.min.css" /> <link rel="stylesheet" href="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.css" /> <link rel="stylesheet" href="http://0.0.0.0:4000/assets/bower_components/bootstrap/dist/css/bootstrap.min.css" /> <link rel="stylesheet" href="http://0.0.0.0:4000/assets/bower_components/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css" /> <link rel="stylesheet" href="http://0.0.0.0:4000/assets/bower_components/icono/dist/icono.min.css" /> <!-- Fonts--> <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet" /> <!-- Favicon --> <link rel="icon" href="http://0.0.0.0:4000/assets/img/favicon.ico" type="image/gif" sizes="16x16" /> <script> var base_url = 'http://0.0.0.0:4000' ; </script> <!-- Jquery --> <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha384-vk5WoKIaW/vJyUAd9n/wmopsmNhiy+L2Z+SBxGYnUkunIxVxAv/UtMOhba/xskxh" crossorigin="anonymous" ></script> <!-- <script src="http://0.0.0.0:4000/assets/bower_components/jquery/dist/jquery.min.js"></script> --> <script src="http://0.0.0.0:4000/assets/js/mode-switcher.js"></script> <script src="http://0.0.0.0:4000/assets/bower_components/jquery.easing/jquery.easing.min.js"></script> <script src="http://0.0.0.0:4000/assets/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script> <script src="http://0.0.0.0:4000/assets/bower_components/jquery-mousewheel/jquery.mousewheel.min.js"></script> <script src="http://0.0.0.0:4000/assets/bower_components/ghosthunter/dist/jquery.ghostHunter.min.js"></script> <script src="http://0.0.0.0:4000/assets/bower_components/lightgallery/dist/js/lightgallery-all.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/picturefill/3.0.2/picturefill.min.js"></script> <script src="http://0.0.0.0:4000/assets/bower_components/imagesloaded/imagesloaded.pkgd.min.js"></script> <script src="http://0.0.0.0:4000/assets/bower_components/nanobar/nanobar.min.js"></script> <script src="http://0.0.0.0:4000/assets/bower_components/typewrite/dist/typewrite.min.js"></script> <script src="http://0.0.0.0:4000/assets/js/search.js"></script> <script src="http://0.0.0.0:4000/assets/js/on-scroll-progress.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script> <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script> <!-- for Mathjax support --> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "AMS" } } }); </script> <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> <!-- Github Button --> <script async defer src="https://buttons.github.io/buttons.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous" ></script> <!-- (you can remove the below scripts but do buy me a coffee to show some support :) --> <!-- Maker widget --> <!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]--> <!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]--> </head> <body> <nav class="navbar navbar-expand-lg fixed-top navbar-dark" id="topNav"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" > <span class="icono-hamburger" id="navbar-hamburger"> </span> </button> <a class="navbar-brand" href="/">Vijay K.</a> <div class="collapse navbar-collapse" id="navbarNav"> <ul class="navbar-nav"> <li class="nav-item"> <a class="nav-link" href="http://0.0.0.0:4000/" >Home</a > </li> <li class="nav-item"> <a class="nav-link" href="http://0.0.0.0:4000/about" >About me</a > </li> <li class="nav-item"> <a class="nav-link" href="http://0.0.0.0:4000/blog" >Blog</a > </li> <li class="nav-item"> <a class="nav-link" href="http://0.0.0.0:4000/contact" >Contact me</a > </li> </ul> </div> <ul class="nav justify-content-end"> <li class="nav-item"> <a class="nav-link toggle-search-button" href="#search"> <i class="fa fa-search search-icon" aria-hidden="true"></i> </a> </li> <li class="nav-item"> <input class="nav-link switch theme-toggle" type="checkbox" name="checkbox" /> </li> </ul> </nav> <div id="progress-bar"></div> <!-- Search Form --> <div class="search-form-container"> <form class="search-form"> <fieldset class="search-form__fieldset"> <div class="row"> <div class="col-lg-8 offset-md-2"> <input class="search-form__field" placeholder="Type to Search..." autofocus> <input class="search-form__submit" type="submit" value="search"> </div> </div> </fieldset> </form> <div class="row"> <div class="col-lg-8 offset-md-2 search-results"> <div class="card search-results"></div> </div> </div> <div class="close-search-button search-form-container__close"> <i class="fa fa-times icon"></i> </div> </div><div class="main-container"> <div class="row justify-content-center" id="blog-post-container"> <div class="col-lg-10"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-header"> <h1 class="post-title" itemprop="name headline">Openshift4 all in one setup</h1> <h4 class="post-meta">Openshift4 all in one setup</h4> <p class="post-summary"> Posted by : <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name"><a href="http://0.0.0.0:4000/blog/authors/vijayk">vijayk</a></span> </span > on <time datetime="2023-02-18 09:05:23 -0600" itemprop="datePublished" >Feb 18, 2023</time > </p> <span class="disqus-comment-count" data-disqus-identifier="/blog/openshift4-all-in-one-setup/" ></span> <div class="post-categories"> Category : <a href="/blog/categories/k8s" >k8s</a > </div> </div> <div class="card-body" itemprop="articleBody"> <img class="card-img-top" src="http://0.0.0.0:4000/assets/img/posts/kubernetes3.jpg" alt="" /> <br /> <br /> <h1 id="ocp-4243-all-in-one-upi-mode">OCP 4.2/4.3 All-In-One (UPI mode)</h1> <p>This document assume reader is familiar with the OCP4x installation process.</p> <h2 id="before-deployment">Before Deployment</h2> <ul> <li>Setup the <code class="language-plaintext highlighter-rouge">install-config.yaml</code> to deploy a single master and no workers ``` apiVersion: v1 baseDomain: example.com compute: <ul> <li>hyperthreading: Enabled name: worker replicas: 0 controlPlane: hyperthreading: Enabled name: master replicas: 1 metadata: name: aio networking: clusterNetworks: <ul> <li>cidr: 10.128.0.0/14 hostPrefix: 23 networkType: OpenShiftSDN serviceNetwork:</li> <li>172.30.0.0/16 platform: none: {} pullSecret: â€˜<your-pull-secret-here>' sshKey: 'ssh-rsa AAA...' ```</your-pull-secret-here></li> </ul> </li> </ul> </li> </ul> <h2 id="during-deployment">During Deployment</h2> <ul> <li>During installation there still need for a temporary external load balancer (or poor man version, modify the DNS entries). <ul> <li>For the installation prepare the DNS equivalent to this: <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  aio.example.com             &lt;ip_aio&gt;
  etcd-0.aio.example.com      &lt;ip_aio&gt;
  apps.aio.example.com        &lt;ip_aio&gt;
  *.apps.aio.example.com      &lt;ip_aio&gt;
  api-int.aio.example.com     &lt;ip_bootstrap&gt;
  api.aio.example.com         &lt;ip_bootstrap&gt;

  # etcd Service Record
  _etcd-server-ssl._tcp.aio.example.com.   IN SRV  0   0   2380    etcd-0.aio.example.com.
</code></pre></div> </div> </li> <li>After <code class="language-plaintext highlighter-rouge">bootkube.service</code> completes modify the DNS <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  aio.example.com             &lt;ip_aio&gt;
  etcd-0.aio.example.com      &lt;ip_aio&gt;
  apps.aio.example.com        &lt;ip_aio&gt;
  *.apps.aio.example.com      &lt;ip_aio&gt;
  api-int.aio.example.com     &lt;ip_aio&gt;
  api.aio.example.com         &lt;ip_aio&gt;

  # etcd Service Record
  _etcd-server-ssl._tcp.aio.example.com.   IN SRV  0   0   2380    etcd-0.aio.example.com.
</code></pre></div> </div> </li> </ul> </li> <li>The single node will be shown with both roles (master and worker) <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ oc get nodes
  NAME   STATUS   ROLES           AGE    VERSION
  aio    Ready    master,worker   33m    v1.16.2
</code></pre></div> </div> </li> <li>Set <code class="language-plaintext highlighter-rouge">etcd-quorum-guard</code> to unmanaged state <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  oc patch clusterversion/version --type='merge' -p "$(cat &lt;&lt;- EOF
  spec:
    overrides:
      - group: apps/v1
        kind: Deployment
        name: etcd-quorum-guard
        namespace: openshift-machine-config-operator
        unmanaged: true
  EOF
  )"
</code></pre></div> </div> </li> <li>Downscale <code class="language-plaintext highlighter-rouge">etcd-quorum-guard</code> to one: <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  oc scale --replicas=1 deployment/etcd-quorum-guard -n openshift-machine-config-operator
</code></pre></div> </div> </li> <li>Downscale the number of routers to one: <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  oc scale --replicas=1 ingresscontroller/default -n openshift-ingress-operator
</code></pre></div> </div> </li> <li>(Recommended) Downscale the number of consoles, authentication, OLM and monitoring services to one: <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  oc scale --replicas=1 deployment.apps/console -n openshift-console
  oc scale --replicas=1 deployment.apps/downloads -n openshift-console

  oc scale --replicas=1 deployment.apps/oauth-openshift -n openshift-authentication

  oc scale --replicas=1 deployment.apps/packageserver -n openshift-operator-lifecycle-manager
    
  # NOTE: When enabled, the Operator will auto-scale this services back to original quantity
  oc scale --replicas=1 deployment.apps/prometheus-adapter -n openshift-monitoring
  oc scale --replicas=1 deployment.apps/thanos-querier -n openshift-monitoring
  oc scale --replicas=1 statefulset.apps/prometheus-k8s -n openshift-monitoring
  oc scale --replicas=1 statefulset.apps/alertmanager-main -n openshift-monitoring
</code></pre></div> </div> </li> <li> <p>(optional) Setup image-registry to use ephemeral storage.</p> <p><strong>WARNING</strong>: Only use ephemeral storage for internal registry for testing purposes.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  oc patch configs.imageregistry.operator.openshift.io cluster --type merge \
  --patch '{"spec":{"storage":{"emptyDir":{}}}}'

  oc patch configs.imageregistry.operator.openshift.io cluster --type merge \
  --patch '{"spec":{"managementState":"Managed"}}'
</code></pre></div> </div> <p>NOTE: Wait until the <code class="language-plaintext highlighter-rouge">image-registry</code> operator completes the update before using the registry.</p> </li> </ul> <br /><!-- Load Facebook SDK for JavaScript --> <div id="fb-root"></div> <script> (function(d, s, id) { var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0"; fjs.parentNode.insertBefore(js, fjs); })(document, "script", "facebook-jssdk"); </script> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8" ></script> <div class="share-page"> <p class="share-text">Share this on &rarr;</p> <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-size="large" data-show-count="false" style="margin-top:5px;" >Tweet</a > <a class="fb-share-button" data-href="http://0.0.0.0:4000/blog/openshift4-all-in-one-setup/" data-size="large" data-layout="button" >Share</a> </div><!-- Author box --> </div><!-- Incomment incase you want to use Disqus <div id="disqus_thread"></div> --> </article> <script> var disqus_config = function () { this.page.url = "http://0.0.0.0:4000/blog/openshift4-all-in-one-setup/"; /* Replace PAGE_URL with your page's canonical URL variable */ this.page.identifier = "/blog/ocp4-aio"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */ }; (function () { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement('script'); s.src = 'https://.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript></div> </div> <div class="row"> <div class="col-md-4"> <div class="card"> <div class="card-header">About Vijay K.</div> <div class="card-body"> <p class="author_bio">Hi! My name is Vijay K. I am a consultent, Engineer, Trainer, Architect and your friend. I am DevOps,cloud and Kubernetes Architect and consultant. 17+ Years of IT Experience. Extensive experience in kubernetes, microservices, container and application platform designing and solutioning in GCP and Azure Cloud. Expertise in GCP and Azure pubic cloud platform. Software life cycle management, CI/CD, Infrastructure provisioning experience with code. Automation and scripting of platform and production development.</p><!-- Place this tag where you want the github button to render. --> <a class="github-button" href="https://github.com/mevijays/training-k8s" data-color-scheme="no-preference: dark; light: dark; dark: dark;" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star sujaykundu777/devlopr-jekyll on GitHub">Star</a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Categories</div> <div class="card-body text-dark"> <div id="#k8s"></div> <li class="tag-head"> <a href="/blog/categories/k8s">k8s</a> </li> <a name="k8s"></a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Useful Links</div> <div class="card-body text-dark"> <li> <a href="http://0.0.0.0:4000/">Home</a> </li> <li> <a href="http://0.0.0.0:4000/about">About me</a> </li> <li> <a href="http://0.0.0.0:4000/blog">Blog</a> </li> <li> <a href="http://0.0.0.0:4000/contact">Contact me</a> </li> </div> </div> </div> </div> </div> <div class="col-lg-12" id="newsletter_footer"><!-- Mailchimp Newletters --> <form action="https://gmail.us10.list-manage.com/subscribe/post?u=ff9e8f3ce82bf1eb36904e570&amp;id=5f324018b2&amp;f_id=007ce8e5f0"method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate> <div id="mc_embed_signup_scroll_footer"> <label for="mce-EMAIL_footer"> Signup if you like to get latest posts mail/</label> <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL_footer" placeholder="email address" required> <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups--> <div style="position: absolute; left: -5000px;" aria-hidden="true"> <input type="text" name="b_50bab1c85eae24ecfb0f68361_3a2dd721d0" tabindex="-1" value=""> </div><br /> <div class="clear"> <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe_footer" class="btn btn-lg btn-success"> </div> </div> </div><footer> <p> mevijay.com | mevijay.dev | vijay@mevijay.com </p> </footer> <script> var options = { classname: 'progressline', id: 'my-id' }; var nanobar = new Nanobar( options ); nanobar.go( 30 ); nanobar.go( 76 ); nanobar.go(100); </script> <div hidden id="snipcart" data-api-key="Y2I1NTAyNWYtMTNkMy00ODg0LWE4NDItNTZhYzUxNzJkZTI5NjM3MDI4NTUzNzYyMjQ4NzU0"></div> <script src="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.js" defer></script> <script> if (window.netlifyIdentity) { window.netlifyIdentity.on("init", user => { if (!user) { window.netlifyIdentity.on("login", () => { document.location.href = "/admin/"; }); } }); } </script> </body> </html>
