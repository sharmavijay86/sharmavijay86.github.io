<!DOCTYPE html> <html lang=" en "><head> <meta charset="utf-8" /> <title> powerdns setup with recursor and pdnsmanager webui - Vijay K. </title> <meta http-equip="X-UA-Compatible" content="IE=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1" /> <meta name="description" content="powerdns setup with recursor and pdnsmanager webui- powerdns setup with recursor and pdnsmanager webui"> <meta name="keywords" content="powerdns setup with recursor and pdnsmanager webui, Vijay K., k8s,"/> <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" /> <meta content="" property="fb:app_id" /> <meta content="Vijay K." property="og:site_name" /> <meta content="powerdns setup with recursor and pdnsmanager webui" property="og:title" /> <meta content="article" property="og:type" /> <meta content="powerdns setup with recursor and pdnsmanager webui" property="og:description" /> <meta content="http://0.0.0.0:4000/blog/setup-powerdns-with-recursor-and-web-ui/" property="og:url" /> <meta content="2023-02-16T05:05:23-06:00" property="article:published_time" /> <meta content="http://0.0.0.0:4000/about/" property="article:author" /> <meta content="http://0.0.0.0:4000/assets/img/posts/kubernetes3.jpg" property="og:image" /> <meta content="k8s" property="article:section" /> <!-- Twitter Cards --> <meta name="twitter:card" content="summary" /> <meta name="twitter:site" content="@" /> <meta name="twitter:creator" content="@" /> <meta name="twitter:title" content="powerdns setup with recursor and pdnsmanager webui" /> <meta name="twitter:url" content="http://0.0.0.0:4000/blog/setup-powerdns-with-recursor-and-web-ui/" /> <meta name="twitter:description" content="powerdns setup with recursor and pdnsmanager webui" /> <link rel="stylesheet" href="http://0.0.0.0:4000/assets/css/main.css" /> <!-- <link rel="stylesheet" href="http://0.0.0.0:4000/assets/css/custom-style.css" /> --> <link rel="stylesheet" href="http://0.0.0.0:4000/assets/bower_components/lightgallery/dist/css/lightgallery.min.css" /> <link rel="stylesheet" href="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.css" /> <link rel="stylesheet" href="http://0.0.0.0:4000/assets/bower_components/bootstrap/dist/css/bootstrap.min.css" /> <link rel="stylesheet" href="http://0.0.0.0:4000/assets/bower_components/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css" /> <link rel="stylesheet" href="http://0.0.0.0:4000/assets/bower_components/icono/dist/icono.min.css" /> <!-- Fonts--> <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet" /> <!-- Favicon --> <link rel="icon" href="http://0.0.0.0:4000/assets/img/favicon.ico" type="image/gif" sizes="16x16" /> <script> var base_url = 'http://0.0.0.0:4000' ; </script> <!-- Jquery --> <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha384-vk5WoKIaW/vJyUAd9n/wmopsmNhiy+L2Z+SBxGYnUkunIxVxAv/UtMOhba/xskxh" crossorigin="anonymous" ></script> <!-- <script src="http://0.0.0.0:4000/assets/bower_components/jquery/dist/jquery.min.js"></script> --> <script src="http://0.0.0.0:4000/assets/js/mode-switcher.js"></script> <script src="http://0.0.0.0:4000/assets/bower_components/jquery.easing/jquery.easing.min.js"></script> <script src="http://0.0.0.0:4000/assets/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script> <script src="http://0.0.0.0:4000/assets/bower_components/jquery-mousewheel/jquery.mousewheel.min.js"></script> <script src="http://0.0.0.0:4000/assets/bower_components/ghosthunter/dist/jquery.ghostHunter.min.js"></script> <script src="http://0.0.0.0:4000/assets/bower_components/lightgallery/dist/js/lightgallery-all.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/picturefill/3.0.2/picturefill.min.js"></script> <script src="http://0.0.0.0:4000/assets/bower_components/imagesloaded/imagesloaded.pkgd.min.js"></script> <script src="http://0.0.0.0:4000/assets/bower_components/nanobar/nanobar.min.js"></script> <script src="http://0.0.0.0:4000/assets/bower_components/typewrite/dist/typewrite.min.js"></script> <script src="http://0.0.0.0:4000/assets/js/search.js"></script> <script src="http://0.0.0.0:4000/assets/js/on-scroll-progress.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script> <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script> <!-- for Mathjax support --> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "AMS" } } }); </script> <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> <!-- Github Button --> <script async defer src="https://buttons.github.io/buttons.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous" ></script> <!-- (you can remove the below scripts but do buy me a coffee to show some support :) --> <!-- Maker widget --> <!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]--> <!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]--> </head> <body> <nav class="navbar navbar-expand-lg fixed-top navbar-dark" id="topNav"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" > <span class="icono-hamburger" id="navbar-hamburger"> </span> </button> <a class="navbar-brand" href="/">Vijay K.</a> <div class="collapse navbar-collapse" id="navbarNav"> <ul class="navbar-nav"> <li class="nav-item"> <a class="nav-link" href="http://0.0.0.0:4000/" >Home</a > </li> <li class="nav-item"> <a class="nav-link" href="http://0.0.0.0:4000/about" >About me</a > </li> <li class="nav-item"> <a class="nav-link" href="http://0.0.0.0:4000/blog" >Blog</a > </li> <li class="nav-item"> <a class="nav-link" href="http://0.0.0.0:4000/contact" >Contact me</a > </li> </ul> </div> <ul class="nav justify-content-end"> <li class="nav-item"> <a class="nav-link toggle-search-button" href="#search"> <i class="fa fa-search search-icon" aria-hidden="true"></i> </a> </li> <li class="nav-item"> <input class="nav-link switch theme-toggle" type="checkbox" name="checkbox" /> </li> </ul> </nav> <div id="progress-bar"></div> <!-- Search Form --> <div class="search-form-container"> <form class="search-form"> <fieldset class="search-form__fieldset"> <div class="row"> <div class="col-lg-8 offset-md-2"> <input class="search-form__field" placeholder="Type to Search..." autofocus> <input class="search-form__submit" type="submit" value="search"> </div> </div> </fieldset> </form> <div class="row"> <div class="col-lg-8 offset-md-2 search-results"> <div class="card search-results"></div> </div> </div> <div class="close-search-button search-form-container__close"> <i class="fa fa-times icon"></i> </div> </div><div class="main-container"> <div class="row justify-content-center" id="blog-post-container"> <div class="col-lg-10"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-header"> <h1 class="post-title" itemprop="name headline">powerdns setup with recursor and pdnsmanager webui</h1> <h4 class="post-meta">powerdns setup with recursor and pdnsmanager webui</h4> <p class="post-summary"> Posted by : <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name"><a href="http://0.0.0.0:4000/blog/authors/vijayk">vijayk</a></span> </span > on <time datetime="2023-02-16 05:05:23 -0600" itemprop="datePublished" >Feb 16, 2023</time > </p> <span class="disqus-comment-count" data-disqus-identifier="/blog/setup-powerdns-with-recursor-and-web-ui/" ></span> <div class="post-categories"> Category : <a href="/blog/categories/k8s" >k8s</a > </div> </div> <div class="card-body" itemprop="articleBody"> <img class="card-img-top" src="http://0.0.0.0:4000/assets/img/posts/kubernetes3.jpg" alt="" /> <br /> <br /> <h2 id="setup-powerdns-with-recursor-and-pdnsmanager-web-ui">Setup powerdns with recursor and pdnsmanager web ui</h2> <p>In ubuntu there would be systemdresolver already running on port 53, hence we will first disable that.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@pdns:~# systemctl stop systemd-resolved
root@pdns:~# systemctl disable systemd-resolved
root@pdns:~# systemctl mask systemd-resolved
</code></pre></div></div> <p>Now open resolv file and keep entry whatever you requires. <br /> Note : This is just for information if you want to make entries static install packages ifupdown and resolvconf</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /etc/resolv.conf

echo "deb http://repo.powerdns.com/ubuntu bionic-auth-41 main" &gt;&gt; /etc/apt/sources.list.d/powerdns.list

</code></pre></div></div> <p>enable repository</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /etc/apt/preferences.d/powerdns
Package: pdns-*
Pin: origin repo.powerdns.com
Pin-Priority: 600

curl -s https://repo.powerdns.com/FD380FBB-pub.asc | sudo apt-key add -
</code></pre></div></div> <p>Now install packages</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt update
apt-get install pdns-server pdns-recursor pdns-backend-mysql mysql-server -y
</code></pre></div></div> <p>Once packages get installed edit pdns config file to make required changes</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /etc/powerdns/pdns.conf
</code></pre></div></div> <p>set bellow entries</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>allow-axfr-ips=127.0.0.1 &lt;ip of your secondary nameserver&gt;
config-dir=/etc/powerdns
daemon=yes
disable-axfr=no
guardian=yes
local-address=0.0.0.0
local-port=54
master=yes
slave=yes
module-dir=/usr/lib/x86_64-linux-gnu/pdns
setgid=pdns
setuid=pdns
socket-dir=/var/run
version-string=powerdns
include-dir=/etc/powerdns/pdns.d
</code></pre></div></div> <p>save and exit <br /> Now we will setup powerdns recursor</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /etc/powerdns/recursor.conf

forward-zones=mylab.local=127.0.0.1:54
forward-zones-recurse=.=1.1.1.1,.=8.8.8.8
local-address=0.0.0.0
local-port=53
</code></pre></div></div> <p>you can use your own forwarders in above config instead 1.1.1.1 and 8.8.8.8 edit mysql for pdns now</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /etc/powerdns/pdns.d/pdns.local.gmysql.conf 

launch=gmysql

gmysql-host=localhost
gmysql-port=3306
gmysql-dbname=pdns
gmysql-user=pdns
gmysql-password=pdns
gmysql-dnssec=no
</code></pre></div></div> <p>save and exit <br /> restart services</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl restart pdns
systemctl restart pdns-recursor
</code></pre></div></div> <p>Now we will create and setup mysql database for dns records <br /> Lets tune some mysql entries for more read request</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /etc/mysql/mysql.conf.d/mysqld.cnf


--- InnoDB section
innodb_log_file_size = 64M
default-storage-engine=INNODB
innodb_buffer_pool_size=1G
innodb_buffer_pool_instances = 2
innodb_autoinc_lock_mode = 2
innodb_doublewrite = 1
innodb_file_per_table = 1
innodb_flush_log_at_trx_commit = 2
innodb_lock_wait_timeout = 60
innodb_locks_unsafe_for_binlog = 1
innodb_stats_on_metadata = 0
transaction-isolation=READ-COMMITTED

service mysql restart
</code></pre></div></div> <p>create database and user</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql&gt; create database powerdns;
mysql&gt; grant all on powerdns.* to 'pdns'@'localhost' identified by 'secret';
</code></pre></div></div> <h4 id="setting-up-pdnsmanager">Setting up pdnsmanager</h4> <p>Install required php and apache packages</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt install php php-apcu php-mysql apache2 -y
</code></pre></div></div> <p>Enable apache modules</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>a2enmod rewrite 
a2enmod ssl
</code></pre></div></div> <p>Setup virtual host in apache</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /etc/apache2/sites-enabled/default.conf

&lt;VirtualHost _default_:443&gt;
    ServerAdmin webmaster@localhost

    ServerName pdns.example.com

    DocumentRoot /var/www/html/frontend

    RewriteEngine On
    RewriteRule ^index\.html$ - [L]
    RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} !-f
    RewriteCond %{DOCUMENT_ROOT}%{REQUEST_FILENAME} !-d
    RewriteRule !^/api/\.* /index.html [L]

    Alias /api /var/www/html/backend/public
    &lt;Directory /var/www/html/backend/public&gt;
        RewriteEngine On
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule ^ index.php [QSA,L]
    &lt;/Directory&gt;

&lt;/VirtualHost&gt;
</code></pre></div></div> <p>Make changes in above as per your need ( keep ssl settingsi have not included them ) <br /> Now get the webui package download , untar and set</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://dl.pdnsmanager.org/pdnsmanager-2.0.1.tar.gz
tar -xvf pdnsmanager-2.0.1.tar.gz
cd pdnsmanager-2.0.1
mv backend /var/www/html/
mv frontend /var/www/html/
chown -R www-data:www-data /var/www/html 
</code></pre></div></div> <p>access url now with /setup use same database entry as given above in mysql</p> <p>Done enjoy!</p> <h4 id="replication-on-master-slave-for-powerdns">replication on master slave for powerdns</h4> <p>powerdns uses mysql as backend in above example hence do all settings on slave server just like above except mysql database. Instead folow guide to <a href="/blog/easy-way-of-mysql-multimaster-setup/">perform mysql database replication</a></p> <br /><!-- Load Facebook SDK for JavaScript --> <div id="fb-root"></div> <script> (function(d, s, id) { var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0"; fjs.parentNode.insertBefore(js, fjs); })(document, "script", "facebook-jssdk"); </script> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8" ></script> <div class="share-page"> <p class="share-text">Share this on &rarr;</p> <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-size="large" data-show-count="false" style="margin-top:5px;" >Tweet</a > <a class="fb-share-button" data-href="http://0.0.0.0:4000/blog/setup-powerdns-with-recursor-and-web-ui/" data-size="large" data-layout="button" >Share</a> </div><!-- Author box --> </div><!-- Incomment incase you want to use Disqus <div id="disqus_thread"></div> --> </article> <script> var disqus_config = function () { this.page.url = "http://0.0.0.0:4000/blog/setup-powerdns-with-recursor-and-web-ui/"; /* Replace PAGE_URL with your page's canonical URL variable */ this.page.identifier = "/blog/pdns-setup"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */ }; (function () { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement('script'); s.src = 'https://.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript></div> </div> <div class="row"> <div class="col-md-4"> <div class="card"> <div class="card-header">About Vijay K.</div> <div class="card-body"> <p class="author_bio">Hi! My name is Vijay K. I am a consultent, Engineer, Trainer, Architect and your friend. I am DevOps,cloud and Kubernetes Architect and consultant. 17+ Years of IT Experience. Extensive experience in kubernetes, microservices, container and application platform designing and solutioning in GCP and Azure Cloud. Expertise in GCP and Azure pubic cloud platform. Software life cycle management, CI/CD, Infrastructure provisioning experience with code. Automation and scripting of platform and production development.</p><!-- Place this tag where you want the github button to render. --> <a class="github-button" href="https://github.com/mevijays/training-k8s" data-color-scheme="no-preference: dark; light: dark; dark: dark;" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star sujaykundu777/devlopr-jekyll on GitHub">Star</a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Categories</div> <div class="card-body text-dark"> <div id="#k8s"></div> <li class="tag-head"> <a href="/blog/categories/k8s">k8s</a> </li> <a name="k8s"></a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Useful Links</div> <div class="card-body text-dark"> <li> <a href="http://0.0.0.0:4000/">Home</a> </li> <li> <a href="http://0.0.0.0:4000/about">About me</a> </li> <li> <a href="http://0.0.0.0:4000/blog">Blog</a> </li> <li> <a href="http://0.0.0.0:4000/contact">Contact me</a> </li> </div> </div> </div> </div> </div> <div class="col-lg-12" id="newsletter_footer"><!-- Mailchimp Newletters --> <form action="https://gmail.us10.list-manage.com/subscribe/post?u=ff9e8f3ce82bf1eb36904e570&amp;id=5f324018b2&amp;f_id=007ce8e5f0"method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate> <div id="mc_embed_signup_scroll_footer"> <label for="mce-EMAIL_footer"> Signup if you like to get latest posts mail/</label> <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL_footer" placeholder="email address" required> <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups--> <div style="position: absolute; left: -5000px;" aria-hidden="true"> <input type="text" name="b_50bab1c85eae24ecfb0f68361_3a2dd721d0" tabindex="-1" value=""> </div><br /> <div class="clear"> <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe_footer" class="btn btn-lg btn-success"> </div> </div> </div><footer> <p> mevijay.com | mevijay.dev | vijay@mevijay.com </p> </footer> <script> var options = { classname: 'progressline', id: 'my-id' }; var nanobar = new Nanobar( options ); nanobar.go( 30 ); nanobar.go( 76 ); nanobar.go(100); </script> <div hidden id="snipcart" data-api-key="Y2I1NTAyNWYtMTNkMy00ODg0LWE4NDItNTZhYzUxNzJkZTI5NjM3MDI4NTUzNzYyMjQ4NzU0"></div> <script src="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.js" defer></script> <script> if (window.netlifyIdentity) { window.netlifyIdentity.on("init", user => { if (!user) { window.netlifyIdentity.on("login", () => { document.location.href = "/admin/"; }); } }); } </script> </body> </html>
