<!DOCTYPE html> <html lang=" en "><head> <meta charset="utf-8" /> <title> kind cluster install - Vijay K. </title> <meta http-equip="X-UA-Compatible" content="IE=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1" /> <meta name="description" content="a Full kubernetes lab with docker and kind - kind cluster install"> <meta name="keywords" content="kind cluster install, Vijay K., k8s,"/> <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" /> <meta content="" property="fb:app_id" /> <meta content="Vijay K." property="og:site_name" /> <meta content="kind cluster install" property="og:title" /> <meta content="article" property="og:type" /> <meta content="a Full kubernetes lab with docker and kind " property="og:description" /> <meta content="http://0.0.0.0:4000/blog/easy-way-to-kind-k8s-cluster-install/" property="og:url" /> <meta content="2023-01-18T09:05:23-06:00" property="article:published_time" /> <meta content="http://0.0.0.0:4000/about/" property="article:author" /> <meta content="http://0.0.0.0:4000/assets/img/posts/kubernetes3.jpg" property="og:image" /> <meta content="k8s" property="article:section" /> <!-- Twitter Cards --> <meta name="twitter:card" content="summary" /> <meta name="twitter:site" content="@" /> <meta name="twitter:creator" content="@" /> <meta name="twitter:title" content="kind cluster install" /> <meta name="twitter:url" content="http://0.0.0.0:4000/blog/easy-way-to-kind-k8s-cluster-install/" /> <meta name="twitter:description" content="a Full kubernetes lab with docker and kind " /> <link rel="stylesheet" href="http://0.0.0.0:4000/assets/css/main.css" /> <!-- <link rel="stylesheet" href="http://0.0.0.0:4000/assets/css/custom-style.css" /> --> <link rel="stylesheet" href="http://0.0.0.0:4000/assets/bower_components/lightgallery/dist/css/lightgallery.min.css" /> <link rel="stylesheet" href="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.css" /> <link rel="stylesheet" href="http://0.0.0.0:4000/assets/bower_components/bootstrap/dist/css/bootstrap.min.css" /> <link rel="stylesheet" href="http://0.0.0.0:4000/assets/bower_components/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css" /> <link rel="stylesheet" href="http://0.0.0.0:4000/assets/bower_components/icono/dist/icono.min.css" /> <!-- Fonts--> <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet" /> <!-- Favicon --> <link rel="icon" href="http://0.0.0.0:4000/assets/img/favicon.ico" type="image/gif" sizes="16x16" /> <script> var base_url = 'http://0.0.0.0:4000' ; </script> <!-- Jquery --> <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha384-vk5WoKIaW/vJyUAd9n/wmopsmNhiy+L2Z+SBxGYnUkunIxVxAv/UtMOhba/xskxh" crossorigin="anonymous" ></script> <!-- <script src="http://0.0.0.0:4000/assets/bower_components/jquery/dist/jquery.min.js"></script> --> <script src="http://0.0.0.0:4000/assets/js/mode-switcher.js"></script> <script src="http://0.0.0.0:4000/assets/bower_components/jquery.easing/jquery.easing.min.js"></script> <script src="http://0.0.0.0:4000/assets/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script> <script src="http://0.0.0.0:4000/assets/bower_components/jquery-mousewheel/jquery.mousewheel.min.js"></script> <script src="http://0.0.0.0:4000/assets/bower_components/ghosthunter/dist/jquery.ghostHunter.min.js"></script> <script src="http://0.0.0.0:4000/assets/bower_components/lightgallery/dist/js/lightgallery-all.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/picturefill/3.0.2/picturefill.min.js"></script> <script src="http://0.0.0.0:4000/assets/bower_components/imagesloaded/imagesloaded.pkgd.min.js"></script> <script src="http://0.0.0.0:4000/assets/bower_components/nanobar/nanobar.min.js"></script> <script src="http://0.0.0.0:4000/assets/bower_components/typewrite/dist/typewrite.min.js"></script> <script src="http://0.0.0.0:4000/assets/js/search.js"></script> <script src="http://0.0.0.0:4000/assets/js/on-scroll-progress.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script> <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script> <!-- for Mathjax support --> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "AMS" } } }); </script> <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> <!-- Github Button --> <script async defer src="https://buttons.github.io/buttons.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous" ></script> <!-- (you can remove the below scripts but do buy me a coffee to show some support :) --> <!-- Maker widget --> <!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]--> <!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]--> </head> <body> <nav class="navbar navbar-expand-lg fixed-top navbar-dark" id="topNav"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" > <span class="icono-hamburger" id="navbar-hamburger"> </span> </button> <a class="navbar-brand" href="/">Vijay K.</a> <div class="collapse navbar-collapse" id="navbarNav"> <ul class="navbar-nav"> <li class="nav-item"> <a class="nav-link" href="http://0.0.0.0:4000/" >Home</a > </li> <li class="nav-item"> <a class="nav-link" href="http://0.0.0.0:4000/about" >About me</a > </li> <li class="nav-item"> <a class="nav-link" href="http://0.0.0.0:4000/blog" >Blog</a > </li> <li class="nav-item"> <a class="nav-link" href="http://0.0.0.0:4000/contact" >Contact me</a > </li> </ul> </div> <ul class="nav justify-content-end"> <li class="nav-item"> <a class="nav-link toggle-search-button" href="#search"> <i class="fa fa-search search-icon" aria-hidden="true"></i> </a> </li> <li class="nav-item"> <input class="nav-link switch theme-toggle" type="checkbox" name="checkbox" /> </li> </ul> </nav> <div id="progress-bar"></div> <!-- Search Form --> <div class="search-form-container"> <form class="search-form"> <fieldset class="search-form__fieldset"> <div class="row"> <div class="col-lg-8 offset-md-2"> <input class="search-form__field" placeholder="Type to Search..." autofocus> <input class="search-form__submit" type="submit" value="search"> </div> </div> </fieldset> </form> <div class="row"> <div class="col-lg-8 offset-md-2 search-results"> <div class="card search-results"></div> </div> </div> <div class="close-search-button search-form-container__close"> <i class="fa fa-times icon"></i> </div> </div><div class="main-container"> <div class="row justify-content-center" id="blog-post-container"> <div class="col-lg-10"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-header"> <h1 class="post-title" itemprop="name headline">kind cluster install</h1> <h4 class="post-meta">a Full kubernetes lab with docker and kind </h4> <p class="post-summary"> Posted by : <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name"><a href="http://0.0.0.0:4000/blog/authors/vijayk">vijayk</a></span> </span > on <time datetime="2023-01-18 09:05:23 -0600" itemprop="datePublished" >Jan 18, 2023</time > </p> <span class="disqus-comment-count" data-disqus-identifier="/blog/easy-way-to-kind-k8s-cluster-install/" ></span> <div class="post-categories"> Category : <a href="/blog/categories/k8s" >k8s</a > </div> </div> <div class="card-body" itemprop="articleBody"> <img class="card-img-top" src="http://0.0.0.0:4000/assets/img/posts/kubernetes3.jpg" alt="" /> <br /> <br /> <h1 id="working-with-kind-cluster">Working with kind cluster</h1> <h2 id="kind-kubernetes-cluster-lab-setup">KIND kubernetes cluster lab setup.</h2> <p><strong>Kind</strong> is a very good option for those who are just starting with kubernetes and dont have suffecient enough resources available. KIND i.e. <strong><em>kubernetes in docker</em></strong> is a binary file using which and docker you can create multiple node k8s cluster, all in docker container.</p> <p><strong>Steps</strong></p> <ul> <li>Docker installation.</li> <li>Kind setup.</li> <li>Kind config file.</li> <li>Setup kind cluster ### <strong>Docker Installation</strong></li> <li>Docker setup steps based on your linux flavor can be find in here.</li> </ul> <ol> <li>Steps for Ubuntu <a href="https://docs.docker.com/engine/install/ubuntu/">Click here</a></li> <li>Steps for Fedora <a href="https://docs.docker.com/engine/install/fedora/">Click here</a></li> <li>Steps for RHEL/CentOS <a href="https://docs.docker.com/engine/install/rhel/">Click here</a></li> </ol> <ul> <li>One script install is also possible here- <a href="../dockersetup.md"> Script install </a></li> </ul> <h3 id="kind-setup"><strong>Kind Setup</strong></h3> <p>Download and setup kind binary.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.17.0/kind-linux-amd64
chmod +x ./kind
sudo mv ./kind /usr/local/bin/kind
</code></pre></div></div> <p>Validate the version.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kind version

 kind v0.11.1 go1.16.4 linux/amd64
</code></pre></div></div> <h3 id="kind-config-file"><strong>Kind config file</strong></h3> <p>Preapre a file with required configuration. Bellow config is a sample which usage extra port mapping for ingress controller.</p> <p>File content</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
  - role: control-plane
    extraPortMappings:
    - containerPort: 80
      hostPort: 80
      listenAddress: "0.0.0.0"
      protocol: TCP
    - containerPort: 443
      hostPort: 443
      listenAddress: "0.0.0.0"
      protocol: TCP
    kubeadmConfigPatches:
    - |
      kind: InitConfiguration
      nodeRegistration:
        kubeletExtraArgs:
          node-labels: "ingress-ready=true"
networking:
  kubeProxyMode: "ipvs"
</code></pre></div></div> <p>File can be found <a href="kind-config.yaml">here</a></p> <h3 id="setup-kind-cluster"><strong>Setup Kind cluster</strong></h3> <p>You can now setup kind cluster by using bellow command.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kind create cluster --name kind --config kind-config.yaml
</code></pre></div></div> <p>check the cluster status</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kind get clusters

docker ps
</code></pre></div></div> <p>To manage the cluster you need kubectl command. Get it setup with this process defined-</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
chmod +x kubectl
sudo mv kubectl /usr/local/bin/
</code></pre></div></div> <p>Now check kind status with kubectl command.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get node
</code></pre></div></div> <h2 id="setup-metric">Setup metric</h2> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl apply -f https://raw.githubusercontent.com/sharmavijay86/sharmavijay86.github.io/master/blog/k8ssetup/components.yaml
</code></pre></div></div> <h2 id="setup-ingress">Setup Ingress</h2> <ol> <li>Install nginx ingress</li> </ol> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/kind/deploy.yaml
</code></pre></div></div> <p>Above is patched version for mainly kind. Please note we have already exposed port 80 and 443 in config yaml file so 80 would be listening on kind host node at 127.0.0.1:80 and 127.0.0.1:443</p> <ol> <li>Setup sample foo bar ingres.</li> </ol> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl apply -f https://kind.sigs.k8s.io/examples/ingress/usage.yaml
</code></pre></div></div> <ol> <li>check it .</li> </ol> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl localhost/foo
curl localhost/bar
</code></pre></div></div> <p>Above is working means we have setup corectly our kind cluster along with nginx ingress controller.</p> <h2 id="how-to-expose-api-for-remote-access">how to expose API for remote access</h2> <p>You see we have exposed nodeport to host machine NIC interface, that is why you can access ingresson kind host ip address. If you wish to access this k8s server from remote machine, then you need api server also to expose on hostport.</p> <p>This just need a configuration line to put in networking section.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
  - role: control-plane
    extraPortMappings:
    - containerPort: 80
      hostPort: 80
      listenAddress: "0.0.0.0"
      protocol: TCP
    - containerPort: 443
      hostPort: 443
      listenAddress: "0.0.0.0"
      protocol: TCP
    kubeadmConfigPatches:
    - |
      kind: InitConfiguration
      nodeRegistration:
        kubeletExtraArgs:
          node-labels: "ingress-ready=true"
networking:
  kubeProxyMode: "ipvs"
  apiServerAddress: "192.168.56.101"
  apiServerPort: 6443

</code></pre></div></div> <ul> <li>Check the services nginx ingress.</li> </ul> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl create deploy webapp --image=nginx:1.22
kubectl expose deploy webapp --port=8080 --target-port=80
kubectl create ingress webapp --class=nginx --rule="abc.lan/*=webappp:80"
</code></pre></div></div> <p>Now make an entry in hosts file for abc.lan and check in browser.</p> <h3 id="ingress-with-config-map-in-nginx122">Ingress with config map in nginx:1.22</h3> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apiVersion: v1
data:
  index.html: |
    &lt;h1&gt;Hello from testing CM mount&lt;/h1&gt;
kind: ConfigMap
metadata:
  creationTimestamp: null
  name: foo
---
apiVersion: apps/v1
kind: Deployment
metadata:
  creationTimestamp: null
  labels:
    app: webcm
  name: webcm
spec:
  replicas: 3
  selector:
    matchLabels:
      app: webcm
  strategy: {}
  template:
    metadata:
      creationTimestamp: null
      labels:
        app: webcm
    spec:
      containers:
      - image: nginx:alpine
        name: nginx
        volumeMounts:
          - name: foo
            mountPath: "/usr/share/nginx/html/"
      volumes:
      - name: foo
        configMap:
           name: foo
---
apiVersion: v1
kind: Service
metadata:
  creationTimestamp: null
  labels:
    app: webcm
  name: webcm
spec:
  ports:
  - port: 80
    protocol: TCP
    targetPort: 80
  selector:
    app: webcm
status:
  loadBalancer: {}
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  creationTimestamp: null
  name: webcm
spec:
  ingressClassName: nginx
  rules:
  - host: ckatcswebcm.lab
    http:
      paths:
      - backend:
          service:
            name: webcm
            port:
              number: 80
        path: /
        pathType: Prefix
status:
  loadBalancer: {}
</code></pre></div></div> <h3 id="etcd-backup-and-restore">ETCD backup and restore</h3> <p><a href="etcd-bkp-restore.md">ETCD Backup and restore process</a></p> <br /><!-- Load Facebook SDK for JavaScript --> <div id="fb-root"></div> <script> (function(d, s, id) { var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0"; fjs.parentNode.insertBefore(js, fjs); })(document, "script", "facebook-jssdk"); </script> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8" ></script> <div class="share-page"> <p class="share-text">Share this on &rarr;</p> <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-size="large" data-show-count="false" style="margin-top:5px;" >Tweet</a > <a class="fb-share-button" data-href="http://0.0.0.0:4000/blog/easy-way-to-kind-k8s-cluster-install/" data-size="large" data-layout="button" >Share</a> </div><!-- Author box --> </div><!-- Incomment incase you want to use Disqus <div id="disqus_thread"></div> --> </article> <script> var disqus_config = function () { this.page.url = "http://0.0.0.0:4000/blog/easy-way-to-kind-k8s-cluster-install/"; /* Replace PAGE_URL with your page's canonical URL variable */ this.page.identifier = "/blog/kind-cluster-setup"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */ }; (function () { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement('script'); s.src = 'https://.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript></div> </div> <div class="row"> <div class="col-md-4"> <div class="card"> <div class="card-header">About Vijay K.</div> <div class="card-body"> <p class="author_bio">Hi! My name is Vijay K. I am a consultent, Engineer, Trainer, Architect and your friend. I am DevOps,cloud and Kubernetes Architect and consultant. 17+ Years of IT Experience. Extensive experience in kubernetes, microservices, container and application platform designing and solutioning in GCP and Azure Cloud. Expertise in GCP and Azure pubic cloud platform. Software life cycle management, CI/CD, Infrastructure provisioning experience with code. Automation and scripting of platform and production development.</p><!-- Place this tag where you want the github button to render. --> <a class="github-button" href="https://github.com/mevijays/training-k8s" data-color-scheme="no-preference: dark; light: dark; dark: dark;" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star sujaykundu777/devlopr-jekyll on GitHub">Star</a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Categories</div> <div class="card-body text-dark"> <div id="#k8s"></div> <li class="tag-head"> <a href="/blog/categories/k8s">k8s</a> </li> <a name="k8s"></a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Useful Links</div> <div class="card-body text-dark"> <li> <a href="http://0.0.0.0:4000/">Home</a> </li> <li> <a href="http://0.0.0.0:4000/about">About me</a> </li> <li> <a href="http://0.0.0.0:4000/blog">Blog</a> </li> <li> <a href="http://0.0.0.0:4000/contact">Contact me</a> </li> </div> </div> </div> </div> </div> <div class="col-lg-12" id="newsletter_footer"><!-- Mailchimp Newletters --> <form action="https://gmail.us10.list-manage.com/subscribe/post?u=ff9e8f3ce82bf1eb36904e570&amp;id=5f324018b2&amp;f_id=007ce8e5f0"method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate> <div id="mc_embed_signup_scroll_footer"> <label for="mce-EMAIL_footer"> Signup if you like to get latest posts mail/</label> <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL_footer" placeholder="email address" required> <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups--> <div style="position: absolute; left: -5000px;" aria-hidden="true"> <input type="text" name="b_50bab1c85eae24ecfb0f68361_3a2dd721d0" tabindex="-1" value=""> </div><br /> <div class="clear"> <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe_footer" class="btn btn-lg btn-success"> </div> </div> </div><footer> <p> mevijay.com | mevijay.dev | vijay@mevijay.com </p> </footer> <script> var options = { classname: 'progressline', id: 'my-id' }; var nanobar = new Nanobar( options ); nanobar.go( 30 ); nanobar.go( 76 ); nanobar.go(100); </script> <div hidden id="snipcart" data-api-key="Y2I1NTAyNWYtMTNkMy00ODg0LWE4NDItNTZhYzUxNzJkZTI5NjM3MDI4NTUzNzYyMjQ4NzU0"></div> <script src="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.js" defer></script> <script> if (window.netlifyIdentity) { window.netlifyIdentity.on("init", user => { if (!user) { window.netlifyIdentity.on("login", () => { document.location.href = "/admin/"; }); } }); } </script> </body> </html>
